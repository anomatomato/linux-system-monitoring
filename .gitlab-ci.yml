default:
  image: anotomato/gcc-cmake:latest

stages:
  - build
  - run

build:
  stage: build
  allow_failure: false
  when: always
  script:
    - mkdir -p build && cd build
    - cmake ..
    - make
  artifacts:
    paths:
      - build/
    expire_in: 1 week

test_inotify_coredump:
  stage: run
  allow_failure: false
  when: on_success
  dependencies:
    - build
  script:
    - cd test/unit
    - ./inotify-coredump-test.sh

# run_bridge:
#   stage: run
#   allow_failure: false
#   when: on_success
#   dependencies:
#     - build
#   script:
#     - cd build
#     - ./bridge-exec

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - build/
